name: run test cases

on: 
  discussion_comment:
    types: [created, edited]
  pull_request_review_comment:
    types: [created, edited]
  issue_comment:
    types: [created, edited]

jobs:
  run-test-cases:
    if: |
      github.event.issue.pull_request && contains(github.event.comment.body, '@cocos-robot run test cases')

    runs-on: ubuntu-latest

    steps:
      - name: 'Checkout engine'
        uses: actions/checkout@v2
        with:
          ref: ${{github.event.issue.pull_request.head.ref}}
          path: engine

      - name: 'CocosCreator version'
        shell: bash
        run: |
          echo "CocosCreator Version: ${{github.base_ref}}"

      - name: 'npm install'
        run: |
          cd engine
          npm -v
          npm install --registry https://registry.npm.taobao.org

      - name: 'Call run test cases job'
        run: |
          python3 -u ./pr-test/main.py ${{github.base_ref}}
